import { describe, it, expect } from '@jest/globals';

import { calculateShardRange } from './shard.js';

describe('calculateShardRange', () => {
    it.each`
        shardIndex | shardTotal | totalTests | expected
        ${0}       | ${0}       | ${0}       | ${undefined}
        ${0}       | ${0}       | ${1}       | ${undefined}
        ${0}       | ${1}       | ${1}       | ${undefined}
        ${1}       | ${1}       | ${0}       | ${undefined}
        ${1}       | ${2}       | ${0}       | ${undefined}
        ${0}       | ${1}       | ${2}       | ${undefined}
        ${2}       | ${2}       | ${1}       | ${undefined}
        ${1}       | ${1}       | ${1}       | ${[0]}
        ${1}       | ${2}       | ${1}       | ${[0]}
        ${1}       | ${2}       | ${2}       | ${[0]}
        ${1}       | ${2}       | ${3}       | ${[0]}
        ${1}       | ${4}       | ${4}       | ${[0]}
        ${2}       | ${2}       | ${2}       | ${[1]}
        ${2}       | ${4}       | ${4}       | ${[1]}
        ${3}       | ${4}       | ${4}       | ${[2]}
        ${4}       | ${4}       | ${4}       | ${[3]}
        ${1}       | ${1}       | ${2}       | ${[0, 1]}
        ${1}       | ${2}       | ${4}       | ${[0, 1]}
        ${1}       | ${2}       | ${5}       | ${[0, 1]}
        ${1}       | ${1}       | ${3}       | ${[0, 2]}
        ${1}       | ${2}       | ${6}       | ${[0, 2]}
        ${1}       | ${2}       | ${7}       | ${[0, 2]}
        ${1}       | ${4}       | ${16}      | ${[0, 3]}
        ${1}       | ${4}       | ${17}      | ${[0, 3]}
        ${1}       | ${4}       | ${20}      | ${[0, 4]}
        ${1}       | ${4}       | ${21}      | ${[0, 4]}
        ${1}       | ${4}       | ${33}      | ${[0, 7]}
        ${1}       | ${4}       | ${77}      | ${[0, 18]}
        ${1}       | ${4}       | ${88}      | ${[0, 21]}
        ${1}       | ${7}       | ${6}       | ${[0]}
        ${6}       | ${7}       | ${6}       | ${[5]}
        ${7}       | ${7}       | ${6}       | ${undefined}
        ${2}       | ${2}       | ${3}       | ${[1, 2]}
        ${2}       | ${2}       | ${4}       | ${[2, 3]}
        ${2}       | ${2}       | ${5}       | ${[2, 4]}
        ${2}       | ${2}       | ${6}       | ${[3, 5]}
        ${2}       | ${2}       | ${7}       | ${[3, 6]}
        ${2}       | ${4}       | ${16}      | ${[4, 7]}
        ${2}       | ${4}       | ${17}      | ${[4, 7]}
        ${2}       | ${4}       | ${20}      | ${[5, 9]}
        ${2}       | ${4}       | ${21}      | ${[5, 9]}
        ${2}       | ${4}       | ${33}      | ${[8, 15]}
        ${2}       | ${4}       | ${77}      | ${[19, 37]}
        ${2}       | ${4}       | ${88}      | ${[22, 43]}
        ${3}       | ${4}       | ${16}      | ${[8, 11]}
        ${3}       | ${4}       | ${17}      | ${[8, 11]}
        ${3}       | ${4}       | ${20}      | ${[10, 14]}
        ${3}       | ${4}       | ${21}      | ${[10, 14]}
        ${3}       | ${4}       | ${33}      | ${[16, 23]}
        ${3}       | ${4}       | ${77}      | ${[38, 56]}
        ${3}       | ${4}       | ${88}      | ${[44, 65]}
        ${4}       | ${4}       | ${16}      | ${[12, 15]}
        ${4}       | ${4}       | ${17}      | ${[12, 16]}
        ${4}       | ${4}       | ${20}      | ${[15, 19]}
        ${4}       | ${4}       | ${21}      | ${[15, 20]}
        ${4}       | ${4}       | ${33}      | ${[24, 32]}
        ${4}       | ${4}       | ${77}      | ${[57, 76]}
        ${4}       | ${4}       | ${88}      | ${[66, 87]}
    `(
        'should return $expected for $shardIndex shardIndex, $shardTotal shardTotal and $totalTests totalTests input',
        ({ shardIndex, shardTotal, totalTests, expected }) => {
            expect(
                calculateShardRange(shardIndex, shardTotal, totalTests)
            ).toEqual(expected);
        }
    );
});
